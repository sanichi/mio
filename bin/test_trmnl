#!/usr/bin/env ruby

# Manual test script for trmnl endpoints.
# Usage: bin/test_trmnl [starling|premier]
# Run this whenever you want to verify the endpoints are working.
# But remember to start the development server first.

require_relative "../config/environment"

# Parse optional argument
endpoint = ARGV[0]
valid_endpoints = %w[starling premier]

if endpoint && !valid_endpoints.include?(endpoint)
  puts "Error: Invalid endpoint '#{endpoint}'"
  puts "Usage: bin/test_trmnl [starling|premier]"
  exit 1
end

def test(name, token)
  url = "http://localhost:3000/trmnl/#{name}"
  puts "Testing #{url}..."
  response = HTTParty.get(url, headers: { "Authorization" => token })
  puts "Status: #{response.code}"
  puts "Content-Type: #{response.content_type}"
  puts "Response:"
  puts JSON.pretty_generate(JSON.parse(response.body))
  puts ""
end

token = Rails.application.credentials.trmnl[:token]
tests = endpoint ? [endpoint] : valid_endpoints
tests.each { |ep| test(ep, token) }
