$(function() {

  var boards = [];

<% fens.each_with_index do |fen, id| %>
  var fen = '<%= j fen %>';
  var elm = fen.match(/\|(.*)/);
  if (elm) {
    var opts = elm[1];
    var o = opts.match(/o:\s*(b|black)/i);
    var n = opts.match(/n:\s*(on|yes|y|true|t|1)/i);
    var m = opts.match(/m:\s*([*,a-z1-8]+)/i);
    Elm.Main.init({
      node: $('#board_<%= id %>').get(0),
      flags: {
        fen: fen,
        orientation: o ? 'black' : 'white',
        notation: n ? true : false,
        marks: m ? m[1].split(',') : []
      }
    });
  } else {
    boards.push(Chessboard("board_<%= id %>", {
      showNotation: <%= fen.match?(/(W|B|N)\Z/) ? 'true' : 'false' %>,
      position: fen,
      orientation: "<%= fen.match?(/b\Z/i) ? 'black' : 'white' %>",
    }));
  }
<% end %>

  $(window).resize(function() {
    $.each(boards, function(i, board) {
      board.resize();
    });
  });

});
