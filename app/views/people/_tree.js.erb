var last_id = <%= person.id %>;
var focus = <%= person.tree_hash(true).to_json.html_safe %>;
function is_pos_int(n) {
  return Number(n) === n && n % 1 === 0 && n > 0;
}
function get_focus(app, id, keep_on_tree) {
  if (!is_pos_int(id)) return;
  if (last_id == id && !keep_on_tree) {
    document.location.href = "/people/" +id;
  }
  else
  {
    $.ajax({
      url: "/people/tree.json?id=" + id
    }).done(function(focus) {
      last_id = focus.person.id;
      app.ports.refocus.send(focus);
    });
  }
}
$(function() {
  var node = $('#elm').get(0);
  var app = Elm.Main.embed(node, { focus: focus });
  app.ports.personId.subscribe(function(id) {
    get_focus(app, id, true);
  })
  $('#term').autocomplete({
    source: '/people/match.json',
    minLength: 2,
    select: function(event, ui) {
      if (ui.item) {
        get_focus(app, ui.item.id, true);
      }
      $(this).val('');
      return false;
    }
  });
});

// var app = Elm.embed(Elm.Main, $('#elm').get(0), { foci: foc });
// app.ports.foci.send(foc);
// app.ports.getFocus.subscribe(get_focus);
// app.ports.random_request.subscribe(function() {
//   var answer = Math.floor((Math.random() * 8 + 1));
//   app.ports.random_response.send(answer);
// });
