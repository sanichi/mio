var last_id = <%= person.id %>;
var foc = <%= person.tree_hash(true).to_json.html_safe %>;
var app = Elm.embed(Elm.Main, $('#elm').get(0), { foci: foc });
app.ports.foci.send(foc);
app.ports.getFocus.subscribe(get_focus);

function get_focus(id, keep_on_tree) {
  if (!is_pos_int(id)) return;

  if (last_id == id && !keep_on_tree) {
    document.location.href = "/people/" +id;
  }
  else
  {
    $.ajax({
      url: "/people/tree.json?id=" + id
    }).done(function(new_foc) {
      last_id = new_foc.person.id;
      app.ports.foci.send(new_foc);
    });
  }
}

$(function() {
  $('#term').autocomplete({
    source: '/people/match.json',
    minLength: 2,
    select: function(event, ui) {
      if (ui.item) {
        get_focus(ui.item.id, true);
      }
      $(this).val('');
      return false;
    }
  });
});

function is_pos_int(n) {
  return Number(n) === n && n % 1 === 0 && n > 0;
}
